title: STM32 FDCAN CAN FD controller

description: |
  STM32 Controller Area Network (CAN) controller with Flexible Data (FD) rate and fixed message RAM
  layout.

compatible: "st,stm32-fdcan"

include: ["bosch,m_can-base.yaml", "pinctrl-device.yaml"]

properties:
  clocks:
    required: true

  reg:
    required: true

  interrupts:
    required: true

  interrupt-names:
    required: true

  clk-divider:
    type: int
    enum:
      - 1
      - 2
      - 4
      - 6
      - 8
      - 10
      - 12
      - 14
      - 16
      - 18
      - 20
      - 22
      - 24
      - 26
      - 28
      - 30
    description: |
      FDCAN kernel/domain clock divider. The resulting clock is fed to the FDCAN time quanta
      clock. Note that the divisor is common to all 'st,stm32-fdcan' instances.

      The clock divider, which is set via the FDCAN_CKDIV register, defaults to divide by 1 unless
      this property is provided.

  external-timestamp-counter:
    type: phandle
    description: |
      Phandle to the counter device to be used as the external RX timestamp source.

      When this property is defined, the driver configures the FDCAN Timestamp
      Counter Configuration (TSCC) to use the External Timestamp (TSS=0x2).

      Hardware Constraint: The selected timer must be physically routed to the
      fdcan_ts input in the SoC interconnect. (e.g. TIM3 on STM32G4). The exact timer
      connected to the fdcan_ts input can be found in the reference manual of the specific SoC.

examples:
  - |
      fdcan1: can@40006400 {
        compatible = "st,stm32-fdcan";
        reg = <0x40006400 0x400>, <0x4000b400 0x350>;
        reg-names = "m_can", "message_ram";
        interrupts = <21 0>, <22 0>;
        interrupt-names = "int0", "int1";
        clocks = <&rcc STM32_CLOCK(APB1, 12)>,
                 <&rcc STM32_SRC_PLL_Q FDCAN_SEL(1)>;
        bosch,mram-cfg = <0x0 28 8 3 3 0 3 3>;
        status = okay";
      };
